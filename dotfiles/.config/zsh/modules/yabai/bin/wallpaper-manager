import{constants as a,promises as e}from"node:fs";import{homedir as t}from"node:os";import r from"node:path";import"zx/globals";let{access:l,readFile:n,writeFile:o}=e,c=a=>r.resolve(t(),a),i=c(".wallpapercache");function s(a){return Number.parseInt(a,10)}function p(a){return`space-${a}`}async function u(){let a=await $`yabai -m query --spaces --space | jq '.index'`,e=await $`yabai -m query --spaces --space | jq '.display'`;return e?{space:s(a.stdout),display:s(e.stdout)-1}:{}}async function w(){try{await l(c(i),a.R_OK|a.W_OK)}catch{throw Error("Could not access wallpaper cache.")}let e=await n(i,"utf8");if(e)return JSON.parse(e)}async function f(a,e,t){let r=c(`.config/wallpapers/${a}.jpg`);try{await $`wallpaper set ${r} --screen ${e}`}catch{throw Error("Could not set wallpaper.")}let l={...t,[p(a)]:r};await o(i,JSON.stringify(l,null,2),"utf8"),console.log(chalk.green("✅ Wallpaper set: "+r))}async function y(){let{space:a,display:e}=await u();if([a,e].includes(void 0))throw Error("No space or display found.");let t=await w();t[p(a)]||await f(a,e,t)}async function d(){await o(i,JSON.stringify({},null,2),"utf8"),console.log(chalk.yellow("\nℹ️  Wallpaper cache cleaned.")),await y()}let[h="change"]=process.argv.slice(2);"change"===h&&await y(),"clean"===h&&await d();